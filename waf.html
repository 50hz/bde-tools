<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Waf Based Build System &mdash; BDE Tools 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="BDE Tools 1.0 documentation" href="index.html" />
    <link rel="next" title="BDE-Style Repository" href="bde_repo.html" />
    <link rel="prev" title="Help" href="help.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="bde_repo.html" title="BDE-Style Repository"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="help.html" title="Help"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">BDE Tools 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="waf-based-build-system">
<span id="waf-top"></span><h1>Waf Based Build System<a class="headerlink" href="#waf-based-build-system" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The waf-based build system supports building <a class="reference internal" href="bde_repo.html#bde-repo-top"><span>BDE-style repositories</span></a>.</p>
<p>Supported build actions include:</p>
<ul class="simple">
<li>Building individual components, packages, or package-groups.</li>
<li>Building and running test drivers.</li>
</ul>
<p>The build system is built on top of <a class="reference external" href="https://code.google.com/p/waf/">waf</a> and
supports all of the vanilla waf commands and options, as well as additional
configuration and build options for working with BDE-style repositories.</p>
<p>For brevity, we&#8217;ll refer to BDE&#8217;s waf-based build system simply as waf
going forward.</p>
</div>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>Running waf requires:</p>
<ul class="simple">
<li>Python 2.6.x - 2.7.x, Python 3.3+</li>
</ul>
<p>Optional:</p>
<ul class="simple">
<li>pkg-config is required for configuring external dependencies.  If pkg-config
is not found on the <code class="docutils literal"><span class="pre">PATH</span></code> environment variable, <a class="reference external" href="https://github.com/gbiggs/pykg-config">pykg-config</a>, a bundled python based pkg-config
replacement tool will be used.</li>
</ul>
<p>For a source-code repository to be built with waf:</p>
<ul class="simple">
<li>The source code must be organized as a <a class="reference internal" href="bde_repo.html#bde-repo-top"><span>BDE-Style Repository</span></a>.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The repository layout can be customized. Please see
<a class="reference internal" href="bde_repo.html#bde-repo-layout-customize"><span>Customizing The Repository Layout</span></a> for more details.</p>
</div>
<ul class="simple">
<li>A copy of <code class="docutils literal"><span class="pre">bde-tools/etc/wscript</span></code> must be located at the root directory of
the repository.</li>
</ul>
<p>You can either run <code class="docutils literal"><span class="pre">bde-tools/bin/waf</span></code> directly or add <code class="docutils literal"><span class="pre">bde-tools/bin</span></code> to
the <code class="docutils literal"><span class="pre">PATH</span></code> environment variable.  The rest of the document assumes that you
have done the later.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal"><span class="pre">bde-tools</span></code> repository contains customziations that may apply to only
the version of waf bundled in the repo.  If you would like to use a globally
installed instance of waf for other projects, then don&#8217;t add
<code class="docutils literal"><span class="pre">bde-tools/bin</span></code> to your <code class="docutils literal"><span class="pre">PATH</span></code>, instead, add to your <code class="docutils literal"><span class="pre">PATH</span></code> a symlink
having a unqiue name (say <code class="docutils literal"><span class="pre">bdewaf</span></code>) pointing to <code class="docutils literal"><span class="pre">bde-tools/bin/waf</span></code>.</p>
</div>
</div>
<div class="section" id="supported-platform-and-compilers">
<span id="waf-supported-platforms"></span><h2>Supported Platform and Compilers<a class="headerlink" href="#supported-platform-and-compilers" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">OS</th>
<th class="head">Compilers</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Linux</td>
<td>gcc 4.1+, clang 3.x</td>
</tr>
<tr class="row-odd"><td>Darwin</td>
<td>gcc 4.1+, clang 3.x</td>
</tr>
<tr class="row-even"><td>Windows</td>
<td>Visual Studio 2008, 2010, 2012, 2013</td>
</tr>
<tr class="row-odd"><td>Solaris</td>
<td>gcc 4.1+, Sun Studio 11, Sun Studio 12</td>
</tr>
<tr class="row-even"><td>AIX</td>
<td>gcc 4.1+, Xlc 9, Xlc 10, Xlc 11</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="quick-start">
<h2>Quick Start<a class="headerlink" href="#quick-start" title="Permalink to this headline">¶</a></h2>
<p>The following steps can be used to build package and package group
libraries, but not test drivers:</p>
<div class="highlight-python"><div class="highlight"><pre>cd &lt;repository root&gt;
waf configure
waf build
</pre></div>
</div>
<p>To also build the test drivers, use:</p>
<div class="highlight-python"><div class="highlight"><pre>waf build --test build
</pre></div>
</div>
<p>To build and run the test drivers, use:</p>
<div class="highlight-python"><div class="highlight"><pre>``shell waf build --test run``
</pre></div>
</div>
<p>For additional examples, see <a class="reference internal" href="#quick-reference">Quick Reference</a>.</p>
</div>
<div class="section" id="commands-and-options">
<h2>Commands and Options<a class="headerlink" href="#commands-and-options" title="Permalink to this headline">¶</a></h2>
<p>Waf commands can be invoked by running:</p>
<div class="highlight-python"><div class="highlight"><pre>waf command [options]
</pre></div>
</div>
<p>Waf provides the following commands, which correspond to popular
Makefile targets in open source projects:</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">configure</span></code></p>
<p>Configure the repository for building and installation, this command
needs to be run only once per build configuration.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">build</span></code></p>
<p>Build the libraries in the repository, including potentially building
and running the test drivers.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">install</span></code></p>
<p>Copy the libraries files, public header files, and the generated
pkg-config files into the installation destination directory.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">clean</span></code></p>
<p>Remove build artifacts but keep the configuration cache.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">distclean</span></code></p>
<p>Remove build artifacts and the configuration cache.</p>
</li>
</ul>
<p>You can view the list of options available for each command by running:
<code class="docutils literal"><span class="pre">shell</span> <span class="pre">waf</span> <span class="pre">--help</span></code> ##Configure Command</p>
<div class="section" id="configure-command">
<h3>Configure Command<a class="headerlink" href="#configure-command" title="Permalink to this headline">¶</a></h3>
<p>The first step in building a BDE-Style repository is to configure the
build by running <code class="docutils literal"><span class="pre">waf</span> <span class="pre">configure</span></code>. This command reads the BDE metadata
files to determine the source files to build, and the appropriate
compiler and linker flags to use. This information is cached, so the
command only needs to be invoked once per build configuration. This
command <strong>must</strong> be invoked from the root path of the repository (the
location of the wscript file).</p>
<div class="highlight-python"><div class="highlight"><pre>waf configure [-t=(UFID)] [--build-type=(debug|release)] [--abi-bits=(32|64)]
              [--library-type=(static|shared)] [--assert-level=(none|safe|safe2)]
              [--out=&lt;output directory&gt;] [--prefix=&lt;install prefix&gt;]
</pre></div>
</div>
<div class="section" id="configure-options">
<h4>Configure Options<a class="headerlink" href="#configure-options" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">-t</span></code></p>
<p>Specify the build configuration using a <a class="reference internal" href="bde_repo.html#bde-repo-ufid"><span>UFID</span></a>.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">--abi-bits</span></code> or <code class="docutils literal"><span class="pre">-a</span></code></p>
<p>choices: <code class="docutils literal"><span class="pre">32</span></code> (default), <code class="docutils literal"><span class="pre">64</span></code></p>
<p>Control whether the build system produces 32-bit x86 (<code class="docutils literal"><span class="pre">32</span></code>) or 64-bit
x86_64 (<code class="docutils literal"><span class="pre">64</span></code>) object files and libraries.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">--assert-level</span></code></p>
<p>choices: <code class="docutils literal"><span class="pre">none</span></code> (default), <code class="docutils literal"><span class="pre">safe</span></code>, <code class="docutils literal"><span class="pre">safe2</span></code></p>
<p>Control the level of &#8220;Safe mode&#8221; builds. &#8220;Safe mode&#8221; enables additional
debugging code in the libraries. See the component level documentation in
<code class="docutils literal"><span class="pre">bsls_assert.h</span></code> for more details on Safe mode.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">--build-type</span></code> or <code class="docutils literal"><span class="pre">-b</span></code></p>
<p>choices: <code class="docutils literal"><span class="pre">debug</span></code> (default), <code class="docutils literal"><span class="pre">release</span></code></p>
<p>Control whether the debug build configuration (<code class="docutils literal"><span class="pre">debug</span></code>, the default) or the
release build configuration (<code class="docutils literal"><span class="pre">release</span></code>) will be used. Debug builds are
unoptimized and include debugging symbols in the resulting binaries. Release
builds are optimized and do not include debugging symbols.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">--library-type</span></code></p>
<p>choices: <code class="docutils literal"><span class="pre">static</span></code> (default), <code class="docutils literal"><span class="pre">shared</span></code></p>
<p>Control whether the build system produces static libraries (<code class="docutils literal"><span class="pre">.a</span></code> files) or
shared libraries (<code class="docutils literal"><span class="pre">.so</span></code> files). Note that shared library builds are
currently <strong>not supported</strong> on windows.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">--out</span></code> or <code class="docutils literal"><span class="pre">-o</span></code></p>
<p>Specify the output directory that will contain the build artifacts and the
configure cache. The default value is &#8216;build&#8217;.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">--prefix</span></code></p>
<p>Set the installation prefix. This is the path where the <code class="docutils literal"><span class="pre">install</span></code> command
install the headers and libraries by default, unless the <code class="docutils literal"><span class="pre">--destdir</span></code> option
is used.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">--msvc_version</span></code></p>
<p>choices: &#8220;msvc 12.0&#8221;, &#8220;msvc 11.0&#8221;, &#8220;msvc 10.0&#8221;, &#8220;msvc 9.0&#8221;</p>
<p>For windows only: use either the compiler and linker provided by Visual
Studio 2013 (msvc 12.0), 2012 (msvc 11.0), 2010 (msvc 10.0), or 2008 (msvc
9.0). Note that by default, waf will select the most recent Visual Studio
installation it detects.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">--verify</span></code></p>
<p>Perform verification of the structure of the repository.  Currently this
option checks whether cycles exist between UORs, packages, and components.</p>
</li>
</ul>
</div>
<div class="section" id="environment-variables">
<h4>Environment Variables<a class="headerlink" href="#environment-variables" title="Permalink to this headline">¶</a></h4>
<p>Some environment variables also affect the behavior of the configure
command. By default, the configure command tries to determine a suitable
C and C++ compiler from the <code class="docutils literal"><span class="pre">PATH</span></code> environment variable. You can
override the compilers used by setting the <code class="docutils literal"><span class="pre">CC</span></code> and <code class="docutils literal"><span class="pre">CXX</span></code>
environment variables. Other environment variables can be used to add
additional preprocessor flags, compiler flags, linker flags, and the
installation prefix.</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">CC</span></code></p>
<p>Set the C compiler that will be used instead of the platform default,
e.g., CC=/usr/bin/gcc-4.8.1. Note that this environment variable is
not applicable when building using Visual Studio on Windows; To
select from multiple visual studio compilers installed on the system,
use the <code class="docutils literal"><span class="pre">--msvc_version</span></code> option instead.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">CXX</span></code></p>
<p>Set the C++ compiler that will be used instead of the platform
default, e.g., CXX=/usr/bin/g++-4.8.1. Note that this environment
variable is not applicable when building using Visual Studio on
Windows; To select from multiple visual studio compilers installed on
the system, use the <code class="docutils literal"><span class="pre">--msvc_version</span></code> option instead.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">CFLAGS</span></code></p>
<p>Set extra C compiler options, e.g., &#8220;-O3&#8221;.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">CXXFLAGS</span></code></p>
<p>Set extra C++ compiler options, e.g., &#8220;-O3&#8221;.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">CPPFLAGS</span></code></p>
<p>Set extra preprocessor options, e.g., &#8220;-DFOO=bar&#8221;.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">LINKFLAGS</span></code></p>
<p>Set extra linker options, e.g., &#8220;-L/usr/local -lsome-library&#8221;.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">PREFIX</span></code></p>
<p>Set the installation prefix to use, if <code class="docutils literal"><span class="pre">--prefix</span></code> option is not
specified. This is the directory where the <code class="docutils literal"><span class="pre">install</span></code> command will
install the headers and built libraries.</p>
</li>
</ul>
<p>Successful execution of the configure command creates a build output
sub-directory, named &#8216;build&#8217; by default (can be set using the <code class="docutils literal"><span class="pre">-o</span></code>
option), that will contain any future build artifacts.</p>
</div>
<div class="section" id="ufid-and-qualified-build-configuration">
<span id="waf-qualified-build-config"></span><h4>UFID And Qualified Build Configuration<a class="headerlink" href="#ufid-and-qualified-build-configuration" title="Permalink to this headline">¶</a></h4>
<p>There are two ways to specify the build configuration:</p>
<ul class="simple">
<li>Specify the <a class="reference external" href="BDE-Style-Repository#ufid">UFID</a> using the <code class="docutils literal"><span class="pre">-t</span></code>
option. For example <code class="docutils literal"><span class="pre">-tdbg_exc_mt</span></code> indicates a &#8220;debug
exception-enabled multi-threading-denabled&#8221; build.</li>
<li>Using the qualified build options, such as <code class="docutils literal"><span class="pre">--abi-bits</span></code>,
<code class="docutils literal"><span class="pre">--build-type</span></code>, <code class="docutils literal"><span class="pre">--library-type</span></code>. The configuration command will
convert these options into a UFID value.</li>
</ul>
<p>If both the UFID (using the <code class="docutils literal"><span class="pre">-t</span></code> option) and some of the qualified
build options are specified, the UFID will take precedence. Note that
the universe of possible build configurations that can be specified
using the UFID is greater than that of qualified build options. For
example, debug and optimized build can both be enabled using the UFID
<code class="docutils literal"><span class="pre">dbg_opt</span></code>. However, this can not be done using the qualified build
options, because <code class="docutils literal"><span class="pre">--build-type</span></code> can be set to either <code class="docutils literal"><span class="pre">debug</span></code> or
<code class="docutils literal"><span class="pre">release</span></code> (equivalent to optimized), but not both. This restriction is
intentional &#8211; the qualified build options are intended to cover the
most frequently used build configurations (especially those used by
application developers), but not the exhaustive set of build
configurations.</p>
</div>
</div>
<div class="section" id="build-command">
<h3>Build Command<a class="headerlink" href="#build-command" title="Permalink to this headline">¶</a></h3>
<p>Once the repository has been configured, it can be built using the the
build command. This command <strong>must</strong> be invoked from a path within the
repository.</p>
<div class="highlight-python"><div class="highlight"><pre>waf build [--targets=&lt;list of targets&gt;] [-j &lt;number of jobs&gt;] [--test=(none|build|run)]
          [--test-v=&lt;test driver verbosity level&gt;] [--test-timeout=&lt;test driver timeout&gt;]
          [--show-test-out]
</pre></div>
</div>
<div class="section" id="build-options">
<h4>Build Options<a class="headerlink" href="#build-options" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">--targets</span></code></p>
<p>Restrict the list of build targets. By default, the build command
will build all targets. You can use <code class="docutils literal"><span class="pre">python</span> <span class="pre">waf</span> <span class="pre">list</span></code> to get a list
of available targets. Multiple targets can be specified via a
comma-delimited list. For example,
<code class="docutils literal"><span class="pre">python</span> <span class="pre">waf</span> <span class="pre">build</span> <span class="pre">--target</span> <span class="pre">bsls,bslstl</span></code> builds only the &#8216;bsls&#8217; and
&#8216;bslstl&#8217; packages (and their dependencies).</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">-j</span></code></p>
<p>Set the number of parallel jobs. By default, this is set to the
number of cores available on the system.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">--test</span></code></p>
<p>choices: <code class="docutils literal"><span class="pre">none</span></code> (default), <code class="docutils literal"><span class="pre">build</span></code>, <code class="docutils literal"><span class="pre">run</span></code></p>
<p>Control whether to build and run test drivers. Test drivers will not
be built if the value is <code class="docutils literal"><span class="pre">none</span></code>; they will be only built if the
value is <code class="docutils literal"><span class="pre">build</span></code>; they will be built and run if the value is
<code class="docutils literal"><span class="pre">run</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">--test-v</span></code></p>
<p>Set the verbosity level of the test output. The default value is 0.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">--test-timeout</span></code></p>
<p>Set the timeout for running each test driver in seconds. The default
value is 200 seconds.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">--show-test-out</span></code></p>
<p>Shows the output of all test drivers. By default, only the output of
failed tests is shown.</p>
</li>
</ul>
</div>
<div class="section" id="build-output">
<h4>Build Output<a class="headerlink" href="#build-output" title="Permalink to this headline">¶</a></h4>
<p>The build process will create a number of sub-directories under the
build output directory:</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">build/c4che</span></code></p>
<p>Contain the cached build settings used by waf.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">build/groups</span></code></p>
<p>Contain the built object files and library files. The relative path
to the build output directory of each output file (source file or
library file) is the same as the relative path of the source file or
directory from which the output file is built.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">build/vc</span></code></p>
<p>Contain a pkg-config file for each package group library.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="install-command">
<h3>Install Command<a class="headerlink" href="#install-command" title="Permalink to this headline">¶</a></h3>
<p>Once the repository has been built, it can be installed using the
install command. This command <strong>must</strong> be invoked from a path within the
repository.</p>
<div class="highlight-python"><div class="highlight"><pre>waf install
</pre></div>
</div>
<p>The install command copies the library files and pkg-config files
created by the build command, along with relevant header files, into the
install directory. The install directory can be specified during the
configuration phase by setting the <code class="docutils literal"><span class="pre">PREFIX</span></code> environment variable or
the <code class="docutils literal"><span class="pre">--prefix</span></code> option. If both options are specified, <code class="docutils literal"><span class="pre">--prefix</span></code>
takes precedence.</p>
<p>The following directory structure will be created in the install
directory:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;destination dir&gt;
 |
 `-- include
 |   |
 |   |-- bsls_util.h
 |   |-- ...                    &lt;-- installed header files
 `-- lib
     |
     |-- libbsl.a
     |-- ...                    &lt;-- installed libraries
     |
     `-- pkgconfig
         |
         |-- bsl.pc
         `-- ...                &lt;-- pkg-config files for each lib
</pre></div>
</div>
</div>
</div>
<div class="section" id="handling-external-dependencies-using-pkg-config">
<span id="waf-pkgconfig"></span><h2>Handling External Dependencies Using Pkg-config<a class="headerlink" href="#handling-external-dependencies-using-pkg-config" title="Permalink to this headline">¶</a></h2>
<p>The dependencies of a package group are specified in the
<a class="reference internal" href="bde_repo.html#bde-repo-dep"><span>Dep File</span></a>. By default, waf will look for the dependencies of a
<a class="reference internal" href="bde_repo.html#bde-repo-uor"><span>UOR</span></a> as other UORs within the repository. Failing that,
waf will attempt to resolve the dependency using <a class="reference external" href="http://www.freedesktop.org/wiki/Software/pkg-config">pkg-config</a>.  This process has the
following benefits:</p>
<ol class="arabic simple">
<li>Allow third party dependencies to be specified in the same way as
internal dependencies.</li>
<li>Allow a single source repo to be easily split into multiple repos, without
requiring any change to the BDE metadata.  Once a repo is split into two,
building the high-level repo requires the lower-level repo be first
installed.</li>
</ol>
<p>The freedesktop site has a <a class="reference external" href="http://people.freedesktop.org/~dbn/pkg-config-guide.html">guide</a> to explain how
pkg-config works. For pkg-config to find an explicit dependency, a <code class="docutils literal"><span class="pre">pc</span></code> file
of that dependency must be located in the path pointed to by the
<code class="docutils literal"><span class="pre">PKG_CONFIG_PATH</span></code> environment variable.</p>
<p>For example, suppose you want the package group <code class="docutils literal"><span class="pre">foo</span></code> to depend on Open
SSL. First, you need to install Open SSL on the system.  Then, you need to
point <code class="docutils literal"><span class="pre">PKG_CONFIG_PATH</span></code> to the path containing <code class="docutils literal"><span class="pre">openssl.pc</span></code>. Finally, you
need to add <code class="docutils literal"><span class="pre">openssl</span></code> as a dependency to <code class="docutils literal"><span class="pre">foo.dep</span></code>. After these three
steps, waf will automatically determine the build flags required to use Open
SSL at configuration time.</p>
</div>
<div class="section" id="building-multiple-repos-using-workspaces">
<span id="waf-workspace"></span><h2>Building Multiple Repos Using Workspaces<a class="headerlink" href="#building-multiple-repos-using-workspaces" title="Permalink to this headline">¶</a></h2>
<p>You have 2 options to work with multiple BDE-style repositories:</p>
<ol class="arabic simple">
<li>Install the lower-level libraries first, and build higher level libraries by
resolving their dependencies using pkg-config (see <a class="reference internal" href="#waf-pkgconfig"><span>Handling External Dependencies Using Pkg-config</span></a>).</li>
<li>The simpler option is to use workspaces, which allows you to build multiple
BDE-style repositories in the same way as a single repository by using the
workspace feature.</li>
</ol>
<p>To use the workspace feature, first, create a workspace directory and check out
the repositories that you want to store in the workspace. Then, simply add an
(empty) file named <code class="docutils literal"><span class="pre">.bdeworkspaceconfig</span></code> and copy <code class="docutils literal"><span class="pre">bde-tools/etc/wscript</span></code>.</p>
<p>See <a class="reference internal" href="tutorials.html#tutorials-workspace"><span>Use waf Workspace to Build Multiple BDE-Style Repositories</span></a> for an example.</p>
</div>
<div class="section" id="building-on-windows">
<span id="waf-windows"></span><h2>Building on Windows<a class="headerlink" href="#building-on-windows" title="Permalink to this headline">¶</a></h2>
<p>Waf can be used on the windows command prompt in the same way as it can
be used on Unix platforms. You can select the version of Visual Studio
compiler to use at configuration time using the <code class="docutils literal"><span class="pre">--msvc_version</span></code>
option.</p>
<p>An important curiosity is that the Visual Studio command line compiler
uses /MT by default, which statically links the C Runtime. This is
different than the IDE, which uses /MD by default (dynamically linking
the C Runtime). The two cannot be mixed. Therefore, if you want to
ensure that BDE dynamically loads the C Runtime, be sure to set your
CXXFLAGS environment variable as follows:</p>
<div class="highlight-python"><div class="highlight"><pre>set CXXFLAGS=/MD
waf configure
waf build
</pre></div>
</div>
<p><em>Important</em>: You should use a <em>regular</em> command prompt (cmd.exe) instead
of the command prompt provided by a specific version of Visual Studio,
because waf can be configured to use a version of Visual Studio
different from the one supported by the that command prompt.</p>
<p>Building using cygwin&#8217;s gcc compiler is not supported. However, you can work in
the cygwin environment, but still use the Visual Studio compiler by invoking
using the provided shell script <code class="docutils literal"><span class="pre">bin/cygwaf.sh</span></code>.</p>
<p>To use <code class="docutils literal"><span class="pre">cygwaf.sh</span></code>, you must export the WIN_PATH environment variable to
point to the <em>cygwin</em> path of the <em>Windows</em> version of Python.</p>
<p>For example, if the Windows version of CPython is installed to #
C:Python27python, then you can use the following command to set up the
required environment variable:</p>
<div class="highlight-python"><div class="highlight"><pre>$ export WIN_PYTHON=/cygdrive/c/Python27/python
$ cygwaf.sh &lt;waf command&gt;
</pre></div>
</div>
<p>Waf also can be used to generate a Visual Studio solution by running the waf
commands &#8216;msvs&#8217; or &#8216;msvs2008&#8217;. The &#8216;msvs&#8217; command generates a Visual Studio
2010 solution named project.sln, and &#8216;msvs2008&#8217; generates a Visual Studio
solution named project_2008.sln.</p>
<p>The generated Visual Studio solution still uses waf as the back-end for
compiling and linking, so it simply serves as an alternate interface
from running waf directly on the command line.</p>
</div>
<div class="section" id="building-on-osx">
<h2>Building on OSX<a class="headerlink" href="#building-on-osx" title="Permalink to this headline">¶</a></h2>
<p>Waf can be used to generate a xcode project by running the waf command
&#8216;xcode&#8217;. This command generates a Xcode project named
foldername.xcodeproj, where &#8216;foldername&#8217; is the name of root directory
of the source repository.</p>
<p>The generated Xcode project still uses waf as the backend for compiling
and linking, so it simply serves as an alternate interface from running
waf directly on the command line.</p>
</div>
<div class="section" id="quick-reference">
<h2>Quick Reference<a class="headerlink" href="#quick-reference" title="Permalink to this headline">¶</a></h2>
<p>Below are examples of build options that are frequently useful during
development:</p>
<div class="highlight-python"><div class="highlight"><pre>cd bde
$ waf --help                        # Help information (all the options
                                    # shown below are documented)

$ waf build                         # Build the entire repository
$ waf build --targets bsl           # Build the bsl package-group
$ waf build --targets bsls          # Build the bsls package
$ waf build --targets bsls_atomic.t # Build the bsls_atomic component

$ waf build --targets bsls --test build
                                    # Build all the components and test
                                    # drivers in bsls

$ waf build --targets bsls_atomic.t --test run
                                    # Build and run the tests for bsls_atomic

$ waf build --targets bsls_atomic.t --test run --show-test-out --test-v 2
                                    # Build and run the test, show the test
                                    # output with verbosity 2

$ waf step --files=&#39;groups/bsl/bslstl/.*\.cpp&#39;
                                        # Force rebuild files in bslstl.  Note
                                        # that --files takes a regular expression
                                        # to the relative path of the files.
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Waf Based Build System</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#supported-platform-and-compilers">Supported Platform and Compilers</a></li>
<li><a class="reference internal" href="#quick-start">Quick Start</a></li>
<li><a class="reference internal" href="#commands-and-options">Commands and Options</a><ul>
<li><a class="reference internal" href="#configure-command">Configure Command</a><ul>
<li><a class="reference internal" href="#configure-options">Configure Options</a></li>
<li><a class="reference internal" href="#environment-variables">Environment Variables</a></li>
<li><a class="reference internal" href="#ufid-and-qualified-build-configuration">UFID And Qualified Build Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#build-command">Build Command</a><ul>
<li><a class="reference internal" href="#build-options">Build Options</a></li>
<li><a class="reference internal" href="#build-output">Build Output</a></li>
</ul>
</li>
<li><a class="reference internal" href="#install-command">Install Command</a></li>
</ul>
</li>
<li><a class="reference internal" href="#handling-external-dependencies-using-pkg-config">Handling External Dependencies Using Pkg-config</a></li>
<li><a class="reference internal" href="#building-multiple-repos-using-workspaces">Building Multiple Repos Using Workspaces</a></li>
<li><a class="reference internal" href="#building-on-windows">Building on Windows</a></li>
<li><a class="reference internal" href="#building-on-osx">Building on OSX</a></li>
<li><a class="reference internal" href="#quick-reference">Quick Reference</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="help.html"
                        title="previous chapter">Help</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="bde_repo.html"
                        title="next chapter">BDE-Style Repository</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/waf.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="bde_repo.html" title="BDE-Style Repository"
             >next</a> |</li>
        <li class="right" >
          <a href="help.html" title="Help"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">BDE Tools 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, Bloomberg Finance L.P..
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>