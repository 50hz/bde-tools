<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>bde_setwafenv.py &mdash; BDE Tools  documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="BDE Tools  documentation" href="index.html" />
    <link rel="prev" title="BDE-Style Repository" href="bde_repo.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="bde_repo.html" title="BDE-Style Repository"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">BDE Tools  documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="bde-setwafenv-py">
<span id="setwafenv-top"></span><h1>bde_setwafenv.py<a class="headerlink" href="#bde-setwafenv-py" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>bde_setwafenv.py is a tool that can be used to simplify the process of
selecting a compiler and managing multiple build flavors (different
platforms/options).</p>
<p>More specifically, the tool helps solve the following problems when using waf:</p>
<ol class="arabic simple">
<li>The output directory of build artifacts is by default just &#8220;build&#8221;.  Without
changing the output directory to be different for every build configuration,
build artifacts for different build configurations will interfere with each
other.</li>
<li>Waf uses a lock file to store the location of the output directory (so that
the output directory won&#8217;t have to be again specified when <code class="docutils literal"><span class="pre">waf</span> <span class="pre">build</span></code> is
invoked).  The name of the lock file is the same for all build
configurations on the same platform.  This means building different build
configurations in parallel is not possible without changing the name of the
lock file to be unqiue for each build configuration.</li>
<li>When working with multiple repositories having dependency relationships.
Developers have to install the repository containing the lower-level
libraries first.  Handling the install process independently for each build
configuration is a hassle in a way similar to problem 1.</li>
</ol>
</div>
<div class="section" id="prerequisites-and-supported-platforms">
<h2>Prerequisites and Supported Platforms<a class="headerlink" href="#prerequisites-and-supported-platforms" title="Permalink to this headline">¶</a></h2>
<p>bde_setwafenv.py requires:</p>
<ul class="simple">
<li>Python 2.6.x - 2.7.x, Python 3.3+, Pypy</li>
</ul>
<p>bde_setwafenv.py is supported on all platform where the <a class="reference internal" href="waf.html#waf-supported-platforms"><span>waf based build
system is supported</span></a>.</p>
<p>On Windows, bde_setwafenv.py is <em>not supported</em> by the windows command
prompt. Instead, you must use the tool through Cygwin or msysgit.  See the
tutorial <a class="reference internal" href="tutorials.html#tutorials-setwafenv-bde-windows"><span>Use bde_setwafenv.py to Build BDE on Windows</span></a> for more details.</p>
</div>
<div class="section" id="how-it-works">
<h2>How It Works<a class="headerlink" href="#how-it-works" title="Permalink to this headline">¶</a></h2>
<p>bde_setwafenv.py prints a list of Bourne shell commands to set environment
variables known to waf, so that configuration options do not need to be
manually provided to <code class="docutils literal"><span class="pre">waf</span> <span class="pre">configure</span></code>.  The end result is that the build
output directory, installation prefix, and the name of the waf lock file are
unique for each build configuration.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Since the bde_setwafenv.py prints shell commands to the standard output, the
output must be executed by the current <em>Bourne</em> shell using the <code class="docutils literal"><span class="pre">eval</span></code>
command.</p>
</div>
</div>
<div class="section" id="usage-examples">
<h2>Usage Examples<a class="headerlink" href="#usage-examples" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first"><code class="docutils literal"><span class="pre">eval</span> <span class="pre">$(bde_setwafenv.py</span> <span class="pre">-c</span> <span class="pre">gcc-4.7.2</span> <span class="pre">-t</span> <span class="pre">dbg_mt_exc</span> <span class="pre">-i</span> <span class="pre">~/bde-install)</span></code></p>
<p>Set up the environment variables so that the waf-based build tool uses the
gcc-4.7.2 compiler, builds with the UFID configuration &#8216;dbg_mt_exc&#8217; to the
output directory <code class="docutils literal"><span class="pre">&lt;uplid&gt;-&lt;ufid&gt;</span></code>, and install the libraries to a
installation prefix of <code class="docutils literal"><span class="pre">~/bde-install/&lt;uplid&gt;-&lt;ufid&gt;</span></code>.</p>
<p>For example, on my system, the uplid was
<code class="docutils literal"><span class="pre">unix-linux-x86_64-2.6.18-gcc-4.7.2</span></code>, and
<code class="docutils literal"><span class="pre">unix-linux-x86_64-2.6.18-gcc-4.7.2-dbg_mt_exc</span></code> was the name of the build
output directory.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">eval</span> <span class="pre">$(bde_setwafenv.py)</span></code></p>
<p>Set up the environment variables so that the BDE waf build tool uses the
default compiler on the current system configured using the default
UFID. Use the default installation prefix, which typically will be
<code class="docutils literal"><span class="pre">/usr/local</span></code> &#8211; this is not recommended, because the default prefix is
typically not writable by a regular user.</p>
</li>
</ol>
<div class="section" id="environment-variables-set-by-bde-setwafenv-py">
<h3>Environment Variables Set by bde_setwafenv.py<a class="headerlink" href="#environment-variables-set-by-bde-setwafenv-py" title="Permalink to this headline">¶</a></h3>
<p>The following environment variables may be set by evaluating the output of
bde_setwafenv.py:</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">CXX</span></code></p>
<p>The path to the C++ compiler.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">BDE_WAF_COMP_FLAGS</span></code></p>
<p>Extra flags that should be passed to the compiler.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">BDE_WAF_UFID</span></code></p>
<p>The <a class="reference internal" href="bde_repo.html#bde-repo-ufid"><span>Valid OS Types</span></a> to use.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">BDE_WAF_UPLID</span></code></p>
<p>The UPLID determined by bde_setewafenv. Note that waf will still generate a
uplid based on the current platform and the compiler being used. If the
generated uplid does not match BDE_WAF_UPLID, then waf will print a warning
message and proceed to use &#8216;BDE_WAF_UPLID&#8217; as the uplid.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">BDE_WAF_BUILD_DIR</span></code></p>
<p>The path in which build artifacts will be generated.  This will be set to the
expanded value of <code class="docutils literal"><span class="pre">&quot;$BDE_WAF_UPLID-$BDE_WAF_UFID</span></code>, so that build directory
is unique for each build configuration.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">WAFLOCK</span></code></p>
<p>The name of lock file to use, this be unique for each build configuration.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">PREFIX</span></code></p>
<p>The installation prefix, which will be set to
<code class="docutils literal"><span class="pre">&lt;root-installation-directory&gt;/$BDE_WAF_UPLID-$BDE_WAF_UFID</span></code>.  See the
description for the <code class="docutils literal"><span class="pre">-i</span></code> option in the <a class="reference internal" href="#setwafenv-options"><span>Options section</span></a> for more details.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">PKG_CONFIG_PATH</span></code></p>
<p>The path containing the .pc files for the installed libraries.  This will be
set to <code class="docutils literal"><span class="pre">$PREFIX/lib/pkgconfig</span></code>.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="configuring-the-available-compilers">
<span id="setwafenv-compiler-config"></span><h2>Configuring the Available Compilers<a class="headerlink" href="#configuring-the-available-compilers" title="Permalink to this headline">¶</a></h2>
<p>On unix-based platforms, bde_setwafenv.py requires a compiler configuration
file located at <code class="docutils literal"><span class="pre">~/.bdecompilerconfig</span></code> to define the compilers that are
available on the system.</p>
<p>On windows, this configuration file is <em>not used</em>.  Since the list of supported
compilers is very limited on windows, it is hard coded into the tool.</p>
<p>The JSON file should have the following format:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span>
    <span class="p">{</span>
        <span class="s">&quot;hostname&quot;</span><span class="p">:</span> <span class="s">&quot;&lt;hostname_regex&gt;&quot;</span><span class="p">,</span>
        <span class="s">&quot;uplid&quot;</span><span class="p">:</span> <span class="s">&quot;&lt;partial-uplid&gt;&quot;</span><span class="p">,</span>
        <span class="s">&quot;compilers&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;&lt;type&gt;&quot;</span><span class="p">,</span>
                <span class="s">&quot;c_path&quot;</span><span class="p">:</span> <span class="s">&quot;&lt;c_path&gt;&quot;</span><span class="p">,</span>
                <span class="s">&quot;cxx_path&quot;</span><span class="p">:</span> <span class="s">&quot;&lt;cxx_path&gt;&quot;</span><span class="p">,</span>
                <span class="s">&quot;version&quot;</span><span class="p">:</span> <span class="s">&quot;&lt;version&gt;&quot;</span><span class="p">,</span>
                <span class="s">&quot;flags&quot;</span><span class="p">:</span> <span class="s">&quot;&lt;flags&gt;&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="o">...</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="o">...</span>
<span class="p">]</span>
</pre></div>
</div>
<p>An sample configuration file can be found at
<code class="docutils literal"><span class="pre">&lt;bde-tools&gt;/share/sample-config/bdecompilerconfig.sample</span></code>.</p>
<p>The JSON file should contain a list of machine context (dictionary) to be
matched, each machine context defines the compilers that are available on the
machine.</p>
<p>A machine context is matched by the following 2 fields:</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">hostname</span></code></p>
<p>An <em>optional</em> field that is a regular expression that matches the host name
of the machine.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">uplid</span></code></p>
<p>A partial <a class="reference internal" href="bde_repo.html#bde-repo-uplid"><span>UPLID</span></a> mask that matches the platform of the
machine.  The first machine context that matches in the list will be chosen.</p>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Tip: if you are using bde_setwafenv.py on one machine.  Don&#8217;t define
<code class="docutils literal"><span class="pre">hostname</span></code> and just use <code class="docutils literal"><span class="pre">-</span></code> (a dash) as <code class="docutils literal"><span class="pre">uplid</span></code>.</p>
</div>
<p>The <code class="docutils literal"><span class="pre">compilers</span></code> field that contains a list of compilers on the machine.  The
first compiler in the list will be treated as the default. A compiler is
represented by a dictionary having the following fields:</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">cxx_path</span></code></p>
<p>The path to the C++ compiler.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">c_path</span></code></p>
<p>The path to the C compiler.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">type</span></code></p>
<p>The type of the compiler.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">version</span></code></p>
<p>The version number of the compiler.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">flags</span></code></p>
<p>This is an <em>optional</em> field that defines additional arguments to pass to this
compiler. This is useful for options such as xlc&#8217;s <code class="docutils literal"><span class="pre">-qpath</span></code> option, which
allows the partial patching of the compiler.</p>
</li>
</ul>
</div>
<div class="section" id="commands-and-options">
<h2>Commands and Options<a class="headerlink" href="#commands-and-options" title="Permalink to this headline">¶</a></h2>
<div class="section" id="commands">
<h3>Commands<a class="headerlink" href="#commands" title="Permalink to this headline">¶</a></h3>
<p>By default, bde_setwafenv.py will print the Bourne shell commands to set
environment variables.</p>
<p>It also provides 2 other optional commands:</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">unset</span></code></p>
<p>Print Bourne shell commands to unset any environment variables that might be
set previous by bde_setwafenv.py.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">list</span></code></p>
<p>List the available compilers on this machine.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">set</span></code></p>
<p>Print Bourne shell commands to set environment variables.  This is the
default command if none is specified. The section <a class="reference internal" href="#setwafenv-options"><span>Set Command Options</span></a>
documents the options available for this command.</p>
</li>
</ul>
</div>
<div class="section" id="set-command-options">
<span id="setwafenv-options"></span><h3>Set Command Options<a class="headerlink" href="#set-command-options" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">-c</span></code></p>
<p>Specify the compiler to use. If not specified, then the default will be used.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">-t</span></code></p>
<p>Specify the build configuration using a <a class="reference internal" href="bde_repo.html#bde-repo-ufid"><span>Valid OS Types</span></a>.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">-i</span></code></p>
<p>Specify the &#8220;root installation directory&#8221;.  This directory is not the same as
the &#8216;&#8211;prefix&#8217; option passed to the &#8216;waf configure&#8217; command. Instead, it
serves as the directory under which a sub-directory, named according to the
uplid (determined by the specified compiler and the current platform) and
ufid, is located.  This sub-directory is the actual prefix location.</p>
<p>This design decision is made so that multiple builds using different
configurations may be installed to the same &#8220;root installation directory&#8221;.
If no installation directory is supplied, but the <code class="docutils literal"><span class="pre">PREFIX</span></code> environment
variable value matches the pattern produced by this script, then the
installation directory previously configured by this script is used.</p>
</li>
</ul>
<p>In addition, most of the configuration option provided by the <a class="reference internal" href="waf.html#waf-top"><span>Waf Based Build System</span></a>
can be used.  Use the <code class="docutils literal"><span class="pre">--help</span></code> option for more information.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">bde_setwafenv.py</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#prerequisites-and-supported-platforms">Prerequisites and Supported Platforms</a></li>
<li><a class="reference internal" href="#how-it-works">How It Works</a></li>
<li><a class="reference internal" href="#usage-examples">Usage Examples</a><ul>
<li><a class="reference internal" href="#environment-variables-set-by-bde-setwafenv-py">Environment Variables Set by bde_setwafenv.py</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuring-the-available-compilers">Configuring the Available Compilers</a></li>
<li><a class="reference internal" href="#commands-and-options">Commands and Options</a><ul>
<li><a class="reference internal" href="#commands">Commands</a></li>
<li><a class="reference internal" href="#set-command-options">Set Command Options</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="bde_repo.html"
                        title="previous chapter">BDE-Style Repository</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/setwafenv.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="bde_repo.html" title="BDE-Style Repository"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">BDE Tools  documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, Bloomberg Finance L.P..
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>